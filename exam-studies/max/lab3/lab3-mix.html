
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
  <script src="https://yihui.name/media/js/center-images.js"></script>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="https://yihui.name/knitr/"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.18</code>)
    .</p>

########################## Lab 3 ############################ Meta-info# Gibbs sampling# MCMC# Mixure normal models# STAN# Credible interval# Effective samples# Task 1: Normal model, mixture of normal model with semi-conjugate prior# a) Implement Gibbs sampler that simulate from a joint posterior. Data is normal# Evaluate Gibbs model graphically# b) Implement Gibbs sampler that simulates form a joint posterior when mixture normal models# Evaluate convergance of model# Task 2: Time series models in Stan# a) Write a function in R that simulates data from given AR(1)-process# b) Treat µ, φ and σ2 as unknowns and estimate them using MCMC. # Report credible interval and effective samples# c) Same as a) and b) but with new data# d) Change σ2 to formative prior################################################################################################################## Task 1 ################ Setupx = read.table("rainfall.dat", header=TRUE)[,1]n = length(x)## priormu0 = mean(x)tau0 = 10v0 = 5 # << n so should not matter too much (w close to 1)sigma0 = 40### Functions### Implementation# a)# Assume: y_1, ..., y_n | µ, σ2 ~ N(µ, σ2), (iid), µ and σ2 are unknown## Prior:# µ ~ N(µ0, τ0_2)# σ2 ~ Inv-X(v0, σ0_2)## Posterior:# µ | σ2, y ~ N(µn, taun_2)# σ2 | µ, y ~ Inv-X[ vn, (v0 * σ0_2 + sum[ (y_i - µ)^2 ]) / (n + v0) ]# to keep track of samplesmu.samples = numeric()sigma2.samples = numeric()# initialize with prior values (any starting point is sufficient)mu.sample = mu0sigma2.sample = sigma0for (i in 1:10000) {
  ## mu sampling
  # mun
  w = (n / sigma2.sample) / ( n / sigma2.sample + 1 / tau0^2 )
  mun = w * mean(x) + (1 - w) / mu0
  # taun2
  taun2 = 1 / (n / sigma2.sample + 1 / tau0^2)
  # sample mu
  mu.sample = rnorm(1, mean = mun, sd = sqrt(taun2))
  #mu.sample = rexp(1, rate = 1 / mun) if you want to try exponential
  mu.samples[i] = mu.sample
  
  ## sigma sampling
  # vn
  vn = n + v0
  # sigma2n
  sigma2n = (v0 * sigma0^2 + sum((x - mu.sample)^2)) / (n + v0)
  chi2 = rchisq(vn, n=1)
  sigma2.sample = vn * sigma2n / chi2
  sigma2.samples[i] = sigma2.sample
}# plot of the trajectoriesplot(mu.samples, type="l")figure/lab3-mix-Rhtmlauto-report-1.pngplot(sigma2.samples, type="l")figure/lab3-mix-Rhtmlauto-report-2.png# histogram of the distributionhist(mu.samples)figure/lab3-mix-Rhtmlauto-report-3.pnghist(sigma2.samples)figure/lab3-mix-Rhtmlauto-report-4.png#b)# Daily precipitation follows an iid two-component mixture of normal distributions# p(y_i | µ, σ2, π) = π * N(y_i | µ1, σ1_2) + (1 - π) * N(y_i | µ2, σ2_2)# µ = (µ1, µ2)# σ2 = (σ1_2, σ2_2)## π ~ Beta(α, β)## Gibbs sampling# π | I, x ~ Beta (α1 + n1, α2 + n2)## Model 1:#     σ1_2 | I, x ~ Inv-X(Vn1, σn1_2)#     µ1 | I, σ1_2, x ~ N(µn1, σ1_2/κn1)## Model 2:#     σ2_2 | I, x ~ Inv-X(Vn_2, σn2_2)#     µ2 | I, σ2_2, x ~ N(µn2, σ2_2/κn1)#     I | π, µ1, σ1_2, µ2, σ2_2, x ~ Bern(θ_i), i = 1, ..., n# Data optionsx = as.matrix(x)# x = as.matrix(rexp(6000, rate=0.025)), interesting comparison# Model optionsnComp <- 2    # Number of mixture components# Prior optionsalpha <- 10 * rep(1,nComp) # Dirichlet(alpha)muPrior <- mu0 * rep(1,nComp) # Prior mean of mutau2Prior <- tau0^2 * rep(1,nComp) # Prior std of musigma2_0 <- sigma0^2 * rep(1,nComp) # Best guessnu0 <- v0 * rep(1,nComp) # degrees of freedom for prior on sigma2# MCMC options# Reaches reasonable distribution at around 35 iterationsnIter <- 100 # Number of Gibbs sampling draws# Plotting optionsplotFit <- TRUElineColors <- c("blue", "green", "magenta", 'yellow')sleepTime <- 2 # Adding sleep time between iterations for plotting################   END USER INPUT ##################### Defining a function that simulates from the rScaledInvChi2 <- function(n, df, scale){
  return((df*scale)/rchisq(n,df=df))
}####### Defining a function that simulates from a Dirichlet distribution# param = c(alpha1 + n1, alpha2 + n2)rDirichlet <- function(param){
  nCat <- length(param)
  piDraws <- matrix(NA,nCat,1)
  for (j in 1:nCat){
    piDraws[j] <- rgamma(1,param[j],1)
  }
  piDraws = piDraws/sum(piDraws) # Diving every column of piDraws by the sum of the elements in that column.
  return(piDraws)
}# Simple function that converts between two different representations of the mixture allocationS2alloc <- function(S){
  n <- dim(S)[1]
  alloc <- rep(0,n)
  for (i in 1:n){
    alloc[i] <- which(S[i,] == 1)
  }
  return(alloc)
}# Initial value for the MCMCnObs <- length(x)S <- t(rmultinom(nObs, size = 1 , prob = rep(1/nComp,nComp))) # nObs-by-nComp matrix with component allocations.mu <- quantile(x, probs = seq(0,1,length = nComp))sigma2 <- rep(var(x),nComp)probObsInComp <- rep(NA, nComp)# Setting up the plotxGrid <- seq(min(x)-1*apply(x,2,sd),max(x)+1*apply(x,2,sd),length = 100)xGridMin <- min(xGrid)xGridMax <- max(xGrid)mixDensMean <- rep(0,length(xGrid))effIterCount <- 0ylim <- c(0,2*max(hist(x)$density))figure/lab3-mix-Rhtmlauto-report-5.pngmus = numeric()for (k in 1:nIter){
  #message(paste('Iteration number:',k))
  alloc <- S2alloc(S) # Just a function that converts between different representations of the group allocations
  nAlloc <- colSums(S)
  #print("nAlloc")
  #print(nAlloc)
  # Update components probabilities
  # alpha = (alpha, beta)
  # nAlloc = (s, f)
  # As nAlloc is changing, pi will tend to move towards the model that includes the most
  # observations
  pi <- rDirichlet(alpha + nAlloc)
  #print("Pi")
  #print(pi)
  # Update mu's
  for (j in 1:nComp){
    precPrior <- 1/tau2Prior[j]
    precData <- nAlloc[j]/sigma2[j]
    precPost <- precPrior + precData
    wPrior <- precPrior/precPost
    muPost <- wPrior*muPrior + (1-wPrior)*mean(x[alloc == j])
    tau2Post <- 1/precPost
    mu[j] <- rnorm(1, mean = muPost, sd = sqrt(tau2Post))
    mus[k] = mu[j]
  }
  
  # Update sigma2's
  for (j in 1:nComp){
    sigma2[j] <- rScaledInvChi2(1, df = nu0[j] + nAlloc[j], scale = (nu0[j]*sigma2_0[j] + sum((x[alloc == j] - mu[j])^2))/(nu0[j] + nAlloc[j]))
  }
  
  # Update allocation
  for (i in 1:nObs){
    for (j in 1:nComp){
      probObsInComp[j] <- pi[j]*dnorm(x[i], mean = mu[j], sd = sqrt(sigma2[j]))
    }
    S[i,] <- t(rmultinom(1, size = 1 , prob = probObsInComp/sum(probObsInComp)))
  }
  
  # Printing the fitted density against data histogram
  if (plotFit && (k%%1 ==0)){
    effIterCount <- effIterCount + 1
    #hist(x, breaks = 20, freq = FALSE, xlim = c(xGridMin,xGridMax), main = paste("Iteration number",k), ylim = ylim)
    mixDens <- rep(0,length(xGrid))
    components <- c()
    for (j in 1:nComp){
      compDens <- dnorm(xGrid,mu[j],sd = sqrt(sigma2[j]))
      mixDens <- mixDens + pi[j]*compDens
      #lines(xGrid, compDens, type = "l", lwd = 2, col = lineColors[j])
      components[j] <- paste("Component ",j)
    }
    mixDensMean <- ((effIterCount-1)*mixDensMean + mixDens)/effIterCount
    
    #lines(xGrid, mixDens, type = "l", lty = 2, lwd = 3, col = 'red')
    #legend("topright", box.lty = 1, legend = c("Data histogram",components, 'Mixture'), 
    #       col = c("black",lineColors[1:nComp], 'red'), lwd = 2)
    #Sys.sleep(sleepTime)
  }
  
}hist(x, breaks = 20, freq = FALSE, xlim = c(xGridMin,xGridMax), main = "Final fitted density")lines(xGrid, mixDensMean, type = "l", lwd = 2, lty = 4, col = "red")lines(xGrid, dnorm(xGrid, mean = mean(x), sd = apply(x,2,sd)), type = "l", lwd = 2, col = "blue")legend("topright", box.lty = 1, legend = c("Data histogram","Mixture density","Normal density"), col=c("black","red","blue"), lwd = 2)figure/lab3-mix-Rhtmlauto-report-6.png# c)par(mfrow = c(1, 1))hist(x, freq=FALSE, breaks=20)lines(xGrid, mixDensMean, type = "l", lwd = 2, lty = 4, col = "red")mu = mean(mu.samples)sigma2 = mean(sigma2.samples)lines(xGrid, dnorm(xGrid, mean = mu, sd=sqrt(sigma2)), type = "l", lwd = 2, col = "blue")legend("topright", box.lty = 1, legend = c("Data histogram", "Mixture density", "Regular Gibbs density"), col = c("black", "red", "blue"), lwd = 2)figure/lab3-mix-Rhtmlauto-report-7.png############# Task 2 ############## a) Write a function that simulates from an AR(1)-process:# x_t = µ + Φ(x_t-1 - µ) + ε_i, ε_i ~ N(0, σ2)## AR(1)-process is stable when -1 <= Φ <= 1# When Φ is either -1 or 1, the process seems to follow a pattern,# when Φ is around 0 it seems ot be random. This is reasonable:# When Φ becomes smaller and smaller, the previous time-series doesn't# affect the future time-series as much. Instead, the error ε# will affect the future time-series. As ε is a normally distributed# error, it will appear to be random.# FunctionAR1_process <- function(mu, sigma2, phi, T) {
  X <- numeric()
  X[1] <- mu
  
  for (t in 2:T) {
    ε <- rnorm(n = 1,
               mean = 0,
               sd = sqrt(sigma2))
    X[t] <- mu + phi*(X[t-1] - mu) + ε
  }
  return(X)
}# Setupµ <- 10σ2 <- 2T <- 200Φ <- seq(-1, 1, 0.1)X <- matrix(nrow = length(Φ),
            ncol = T)for (t in 1:length(Φ)) {
  X[t, ] <- AR1_process(µ, σ2, Φ[t], T)
}par(mfrow = c(4, 4))for (t in 1:length(Φ)) {
  main_legend <- paste(c("Φ:",Φ[t]), collapse= " ")
  plot(X[t,], 
       ylab = "x_t",
       xlab = "Index: t",
       main = main_legend)
}figure/lab3-mix-Rhtmlauto-report-8.png# b)library(rstan)# Setupµ <- 10σ2 <- 2T <- 200Φ1 <- 0.3Φ2 <- 0.95# AR(1)-processes for each phi.# Create ground truth datasetX_Φ1 <- AR1_process(µ, σ2, Φ1, T)X_Φ2 <- AR1_process(µ, σ2, Φ2, T)# Stan-code# You need to define the variables stan_program = '
data {
int<lower=0> T;
vector[T] X;
}
parameters {
real mu;
real<lower=0> sigma;
real phi;
}
model {
for (t in 2:T) 
X[t] ~ normal(mu + phi * (X[t-1] - mu), sigma);
}
'nIter <- 4000burnIn <- 1000# To find information within the stan.res-variable:# summary(stan.res.Φ1): All information# summary(stan.res.Φ1)$summary: Just the summary# extract(stan.res.Φ1): The estimastes of variables# The percentages in the summary are the credible intervals of the# covariates. When phi is large, the CI-interval of mu will be very wide.# This is because it will be affected of previous time-series alot.# Effective posterior samples:# When the observations in a sample distribution is correlated or weighted,# the effective sample size is calculated.# Effective sample size is thought of as an "Exchange rate" between# dependent and independent samples. For example, 1000 dependent samples# are worth as much as 80 independent samples.# If the samples are independent, the effective sample size equals the# actual sample size.stan.res.Φ1 <- stan(model_code = stan_program,
                    data = list(X = X_Φ1, N = T),
                    warmup = burnIn,
                    iter = nIter)## 
## SAMPLING FOR MODEL '3b632fb7ad1804fd14c325e75389891a' NOW (CHAIN 1).
## 
## Gradient evaluation took 5.8e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.58 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.14672 seconds (Warm-up)
##                0.420627 seconds (Sampling)
##                0.567347 seconds (Total)
## 
## 
## SAMPLING FOR MODEL '3b632fb7ad1804fd14c325e75389891a' NOW (CHAIN 2).
## 
## Gradient evaluation took 2.7e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.27 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.183814 seconds (Warm-up)
##                0.412223 seconds (Sampling)
##                0.596037 seconds (Total)
## 
## 
## SAMPLING FOR MODEL '3b632fb7ad1804fd14c325e75389891a' NOW (CHAIN 3).
## 
## Gradient evaluation took 3.6e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.36 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.774038 seconds (Warm-up)
##                0.448999 seconds (Sampling)
##                1.22304 seconds (Total)
## 
## 
## SAMPLING FOR MODEL '3b632fb7ad1804fd14c325e75389891a' NOW (CHAIN 4).
## 
## Gradient evaluation took 2.6e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.26 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.168115 seconds (Warm-up)
##                0.41921 seconds (Sampling)
##                0.587325 seconds (Total)
stan.res.Φ2 <- stan(model_code = stan_program,
                    data = list(X = X_Φ2, N = T),
                    warmup = burnIn,
                    iter = nIter)## 
## SAMPLING FOR MODEL '3b632fb7ad1804fd14c325e75389891a' NOW (CHAIN 1).
## 
## Gradient evaluation took 4e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.4 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.210057 seconds (Warm-up)
##                0.567639 seconds (Sampling)
##                0.777696 seconds (Total)
## 
## 
## SAMPLING FOR MODEL '3b632fb7ad1804fd14c325e75389891a' NOW (CHAIN 2).
## 
## Gradient evaluation took 2.6e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.26 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.491725 seconds (Warm-up)
##                0.623406 seconds (Sampling)
##                1.11513 seconds (Total)
## 
## 
## SAMPLING FOR MODEL '3b632fb7ad1804fd14c325e75389891a' NOW (CHAIN 3).
## 
## Gradient evaluation took 2.2e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.22 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.342314 seconds (Warm-up)
##                0.463524 seconds (Sampling)
##                0.805838 seconds (Total)
## 
## 
## SAMPLING FOR MODEL '3b632fb7ad1804fd14c325e75389891a' NOW (CHAIN 4).
## 
## Gradient evaluation took 3.8e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.38 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.501361 seconds (Warm-up)
##                0.606022 seconds (Sampling)
##                1.10738 seconds (Total)
## Warning: There were 34 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See
## http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
## Warning: Examine the pairs() plot to diagnose sampling problems
# Plotpar(mfrow = c(1, 2))figure/lab3-mix-Rhtmlauto-report-9.pngplot(extract(stan.res.Φ1)$mu, extract(stan.res.Φ1)$phi)plot(extract(stan.res.Φ2)$mu, extract(stan.res.Φ2)$phi)figure/lab3-mix-Rhtmlauto-report-10.pngplot(extract(stan.res.Φ1)$mu, type='l')plot(extract(stan.res.Φ2)$mu, type='l')figure/lab3-mix-Rhtmlauto-report-11.png# c)# campy.dat: No. of cases of campylobacter infections in the north of# province Quebec (Canada). Data recorded in 4 weeks intervals from# January 1990 to end of October 2000.# 13 observations/year# 140 observations in total# c_t: No. of infections at each timepoint.# c_t follows an indenepdent Poisson distribution when conditioned on a# latent AR(1)-process x_t:##     c_t | x_t ~ Poisson(exp(x_t))## x_t: Same AR(1)-process as in a)X.campy <- read.table("campy.dat", header = TRUE)T <- dim(X.campy)[1]stan_program = '
data {
int<lower=0> T;
int c[T];
}
parameters {
real phi;
real sigma;
real mu;
vector[T] X;
}
model {
phi ~ uniform(-1, 1);
for (t in 2:T)
X[t] ~ normal(mu + phi*(X[t-1] - mu), sigma);

for (t in 1:T)
c[t] ~ poisson(exp(X[t]));
}
'# Setup STANnIter <- 4000burnIn <- 1000# Stanstan.res.campy <- stan(model_code = stan_program,
                       data = list(c = X.campy[, 1], T = T),
                       warmup = burnIn,
                       iter = nIter)## 
## SAMPLING FOR MODEL 'b2000ee53cd8e4503b6dbeb228ca3ca0' NOW (CHAIN 1).
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -1.97976, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## 
## Gradient evaluation took 7.1e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.71 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.834304 seconds (Warm-up)
##                1.7162 seconds (Sampling)
##                2.55051 seconds (Total)
## 
## 
## SAMPLING FOR MODEL 'b2000ee53cd8e4503b6dbeb228ca3ca0' NOW (CHAIN 2).
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -0.529769, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -1.2249, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -0.556225, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -0.0350187, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -0.367231, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -0.000299977, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -1.26831, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -0.14109, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## 
## Gradient evaluation took 3.5e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.35 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.82895 seconds (Warm-up)
##                1.76058 seconds (Sampling)
##                2.58953 seconds (Total)
## 
## 
## SAMPLING FOR MODEL 'b2000ee53cd8e4503b6dbeb228ca3ca0' NOW (CHAIN 3).
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -0.638259, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is -1.58583, but must be > 0!  (in 'model10f9669ee0d2f_b2000ee53cd8e4503b6dbeb228ca3ca0' at line 15)
## 
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## 
## Gradient evaluation took 3.4e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.34 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.915797 seconds (Warm-up)
##                1.95928 seconds (Sampling)
##                2.87508 seconds (Total)
## 
## 
## SAMPLING FOR MODEL 'b2000ee53cd8e4503b6dbeb228ca3ca0' NOW (CHAIN 4).
## 
## Gradient evaluation took 3.3e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.33 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 0.857136 seconds (Warm-up)
##                2.01232 seconds (Sampling)
##                2.86946 seconds (Total)
## Warning: There were 55 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See
## http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
## Warning: Examine the pairs() plot to diagnose sampling problems
# Mean of c_i. Calculated by taking the mean of exp(X), where X is generated by STAN.mean_stan <- exp(apply(extract(stan.res.campy)$X, MARGIN = 2, mean))# Credible intervalstan.summary <- summary(stan.res.campy)$summaryCI_lower <- exp(stan.summary[-(1:3), "2.5%"])CI_upper <- exp(stan.summary[-(1:3), "97.5%"])# Plotplot(X.campy[,1]) # Plot datalines(mean_stan, col = rgb(1, 0, 0, 1)) # Plot mean of stanlines(CI_lower, col = rgb(0, 1, 0, 1)) # Plot lower Credible intervallines(CI_upper, col = rgb(0, 1, 0, 1)) # Plot upper Credible interval# Hist of theta_ihist(log(mean_stan), breaks = 200)figure/lab3-mix-Rhtmlauto-report-12.png# d)# A Scaled inverse chi square prior has been added to sigma2.stan_program = '
data {
int<lower=0> T;
int c[T];
}
parameters {
real phi;
real sigma2;
real mu;
vector[T] X;
}
model {
phi ~ uniform(-1, 1);
sigma2 ~ scaled_inv_chi_square(T, 0.03);

for (t in 2:T)
X[t] ~ normal(mu + phi*(X[t-1] - mu), sqrt(sigma2));

for (t in 1:T)
c[t] ~ poisson(exp(X[t]));
}
'# Setup STANnIter <- 4000burnIn <- 1000# Stanstan.res.campy <- stan(model_code = stan_program,
                       data = list(c = X.campy[, 1], T = T),
                       warmup = burnIn,
                       iter = nIter)## recompiling to avoid crashing R session
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core.hpp:12:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/gevv_vvv_vari.hpp:5:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/var.hpp:7:
## In file included from /usr/local/lib/R/3.4/site-library/BH/include/boost/math/tools/config.hpp:13:
## In file included from /usr/local/lib/R/3.4/site-library/BH/include/boost/config.hpp:39:
## /usr/local/lib/R/3.4/site-library/BH/include/boost/config/compiler/clang.hpp:200:11: warning: 'BOOST_NO_CXX11_RVALUE_REFERENCES' macro redefined [-Wmacro-redefined]
## #  define BOOST_NO_CXX11_RVALUE_REFERENCES
##           ^
## <command line>:6:9: note: previous definition is here
## #define BOOST_NO_CXX11_RVALUE_REFERENCES 1
##         ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core.hpp:14:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/matrix_vari.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat/fun/Eigen_NumTraits.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Dense:1:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Core:531:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core.hpp:14:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/matrix_vari.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat/fun/Eigen_NumTraits.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Dense:2:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/LU:47:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core.hpp:14:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/matrix_vari.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat/fun/Eigen_NumTraits.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Dense:3:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Cholesky:12:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Jacobi:29:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core.hpp:14:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/matrix_vari.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat/fun/Eigen_NumTraits.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Dense:3:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Cholesky:43:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core.hpp:14:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/matrix_vari.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat/fun/Eigen_NumTraits.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Dense:4:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/QR:17:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Householder:27:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core.hpp:14:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/matrix_vari.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat/fun/Eigen_NumTraits.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Dense:5:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/SVD:48:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core.hpp:14:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/matrix_vari.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat/fun/Eigen_NumTraits.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Dense:6:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Geometry:58:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core.hpp:14:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/core/matrix_vari.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat/fun/Eigen_NumTraits.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Dense:7:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Eigenvalues:58:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:12:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat.hpp:83:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/csr_extract_u.hpp:6:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Sparse:26:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/SparseCore:66:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:12:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat.hpp:83:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/csr_extract_u.hpp:6:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Sparse:27:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/OrderingMethods:71:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:12:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat.hpp:83:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/csr_extract_u.hpp:6:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Sparse:29:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/SparseCholesky:43:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:12:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat.hpp:83:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/csr_extract_u.hpp:6:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Sparse:32:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/SparseQR:35:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## In file included from file10f9643dd1e9a.cpp:8:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/src/stan/model/model_header.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math.hpp:4:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/rev/mat.hpp:12:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat.hpp:83:
## In file included from /usr/local/lib/R/3.4/site-library/StanHeaders/include/stan/math/prim/mat/fun/csr_extract_u.hpp:6:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/Sparse:33:
## In file included from /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/IterativeLinearSolvers:46:
## /usr/local/lib/R/3.4/site-library/RcppEigen/include/Eigen/src/Core/util/ReenableStupidWarnings.h:10:30: warning: pragma diagnostic pop could not pop, no matching push [-Wunknown-pragmas]
##     #pragma clang diagnostic pop
##                              ^
## 14 warnings generated.
## 
## SAMPLING FOR MODEL 'd8491c4232019de71e97f62a286d5cc4' NOW (CHAIN 1).
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## 
## Gradient evaluation took 3.9e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.39 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 15.4318 seconds (Warm-up)
##                30.2213 seconds (Sampling)
##                45.6532 seconds (Total)
## 
## 
## SAMPLING FOR MODEL 'd8491c4232019de71e97f62a286d5cc4' NOW (CHAIN 2).
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## 
## Gradient evaluation took 3.2e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.32 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 16.4586 seconds (Warm-up)
##                33.3394 seconds (Sampling)
##                49.7981 seconds (Total)
## 
## 
## SAMPLING FOR MODEL 'd8491c4232019de71e97f62a286d5cc4' NOW (CHAIN 3).
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## 
## Gradient evaluation took 3.8e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.38 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 15.221 seconds (Warm-up)
##                40.917 seconds (Sampling)
##                56.1379 seconds (Total)
## 
## 
## SAMPLING FOR MODEL 'd8491c4232019de71e97f62a286d5cc4' NOW (CHAIN 4).
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## Rejecting initial value:
##   Error evaluating the log probability at the initial value.
## Exception: normal_lpdf: Scale parameter is nan, but must be > 0!  (in 'model10f96454346cc_d8491c4232019de71e97f62a286d5cc4' at line 17)
## 
## Rejecting initial value:
##   Log probability evaluates to log(0), i.e. negative infinity.
##   Stan can't start sampling from this initial value.
## 
## Gradient evaluation took 3.2e-05 seconds
## 1000 transitions using 10 leapfrog steps per transition would take 0.32 seconds.
## Adjust your expectations accordingly!
## 
## 
## Iteration:    1 / 4000 [  0%]  (Warmup)
## Iteration:  400 / 4000 [ 10%]  (Warmup)
## Iteration:  800 / 4000 [ 20%]  (Warmup)
## Iteration: 1001 / 4000 [ 25%]  (Sampling)
## Iteration: 1400 / 4000 [ 35%]  (Sampling)
## Iteration: 1800 / 4000 [ 45%]  (Sampling)
## Iteration: 2200 / 4000 [ 55%]  (Sampling)
## Iteration: 2600 / 4000 [ 65%]  (Sampling)
## Iteration: 3000 / 4000 [ 75%]  (Sampling)
## Iteration: 3400 / 4000 [ 85%]  (Sampling)
## Iteration: 3800 / 4000 [ 95%]  (Sampling)
## Iteration: 4000 / 4000 [100%]  (Sampling)
## 
##  Elapsed Time: 14.9212 seconds (Warm-up)
##                33.3488 seconds (Sampling)
##                48.27 seconds (Total)
## Warning: There were 3126 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See
## http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
## Warning: There were 105 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See
## http://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded
## Warning: Examine the pairs() plot to diagnose sampling problems
# Mean of c_i. Calculated by taking the mean of exp(X), where X is generated by STAN.mean_stan <- exp(apply(extract(stan.res.campy)$X, MARGIN = 2, mean))# Credible intervalstan.summary <- summary(stan.res.campy)$summaryCI_lower <- exp(stan.summary[-(1:3), "2.5%"])CI_upper <- exp(stan.summary[-(1:3), "97.5%"])# Plotplot(X.campy[,1]) # Plot datalines(mean_stan, col = rgb(1, 0, 0, 1)) # Plot mean of stanlines(CI_lower, col = rgb(0, 1, 0, 1)) # Plot lower Credible intervallines(CI_upper, col = rgb(0, 1, 0, 1)) # Plot upper Credible interval# Histogramhist(log(mean_stan), breaks = 200)figure/lab3-mix-Rhtmlauto-report-13.pnglibrary(knitr) stitch(script="lab3-mix.R", system.file("misc", "knitr-template.Rhtml", package="knitr"))## 
## 
## processing file: lab3-mix.Rhtml
## Error in parse_block(g[-1], g[1], params.src): duplicate label 'setup'


  <p>The R session information (including the OS info, R version and all
    packages used):</p>

    sessionInfo()## R version 3.4.2 (2017-09-28)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: OS X El Capitan 10.11.6
## 
## Matrix products: default
## BLAS: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
## LAPACK: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] mvtnorm_1.0-7      knitr_1.18         rstan_2.17.3       StanHeaders_2.17.2
## [5] ggplot2_2.2.1     
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.13     codetools_0.2-15 grid_3.4.2       plyr_1.8.4       gtable_0.2.0    
##  [6] magrittr_1.5     stats4_3.4.2     evaluate_0.10.1  scales_0.5.0     highr_0.6       
## [11] stringi_1.1.5    rlang_0.1.4      lazyeval_0.2.1   tools_3.4.2      stringr_1.2.0   
## [16] munsell_0.4.3    yaml_2.1.16      compiler_3.4.2   inline_0.3.14    colorspace_1.3-2
## [21] gridExtra_2.3    tibble_1.3.4
    Sys.time()## [1] "2018-05-28 20:45:17 CEST"



</body>
</html>
